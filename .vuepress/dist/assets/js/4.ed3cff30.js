(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{322:function(t,s,a){t.exports=a.p+"assets/img/gzmetromap.d851a6b6.png"},323:function(t,s,a){t.exports=a.p+"assets/img/GIFofMap.45d2091d.gif"},332:function(t,s,a){"use strict";a.r(s);var n=a(33),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"广州地铁有多挤-数据获取"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#广州地铁有多挤-数据获取"}},[t._v("#")]),t._v(" "),n("font",{attrs:{size:"6"}},[t._v("广州地铁有多挤-数据获取")])],1),t._v(" "),n("blockquote",[n("p",[n("font",{attrs:{size:"5,",color:"grey"}},[t._v("单页爬虫实时监听")])],1)]),t._v(" "),n("h1",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" "),n("font",{attrs:{size:"5"}},[t._v("简介")])],1),t._v(" "),n("p",[t._v("  因为每天都要挤地铁上班，周遭劳顿。等车的时候，我突然想到了这么个问题：广州地铁到底有多挤？")]),t._v(" "),n("p",[t._v("  于是想采集一些数据做点分析，需要采集哪些数据？数据在哪里呢？💡")]),t._v(" "),n("p",[t._v("  首先是常量数据，每个站点的客容量，一趟列车的总承载，车次安排时间表等等；然后是流动数据，只要记录个人进站出站的时间地点即可；另外定义好一系列数据特征来刻画系统状态，比如单位时间流入-流出为积累速率，存量乘客/客容量 > 90%为拥堵等等。")]),t._v(" "),n("p",[t._v("  在这套数据基础上可以引入算法深入分析系统运行效率：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("分类问题：")]),t._v(" 把高峰时段乘客分类出来，训练集包括历史乘车信息和乘客类型。像我这种周一到周五，定时定点稳定出现的肯定就是打工仔了；之前都没来过的突然赶这班车，应该就是临时出差的；再有定点不定时的，可能是房东出门买菜...")]),t._v(" "),n("li",[n("strong",[t._v("预测问题：")]),t._v(" 在分类的基础上假定每天高峰时段各类乘客数量大体稳定，客流量服从动态的(密度=剩余高峰乘客/剩余高峰时间)泊松分布，站点多久将进入拥堵态？拥堵时长多长？")]),t._v(" "),n("li",[n("strong",[t._v("优化问题：")]),t._v(" 根据需求侧结构对资源配置做参数优化，是否可以调整车次时间表使得拥堵时长减小？")])]),t._v(" "),n("h1",{attrs:{id:"采集"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#采集"}},[t._v("#")]),t._v(" "),n("font",{attrs:{size:"5"}},[t._v("采集")])],1),t._v(" "),n("p",[t._v("  以上内容都是我被人抵在车门口单手扣着指示板😫想出来的，有得搞吗？屁坨...个人交通信息怎么可能搞得到，最后我想广州地铁官方会不会有数据披露，于是我找到了"),n("a",{attrs:{href:"http://ydyc.gzmtr.cn:19090/pcindex.html#/",target:"_blank",rel:"noopener noreferrer"}},[t._v("广州地铁客流实时信息显示系统"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(322),alt:"gzmetromap"}})]),t._v(" "),n("p",[t._v("  页面是张实时地铁信息图，包括站点和双向通行情况。虽然官方并没有给出具体的统计口径，这样也免去重新定义系统状态的必要了。不多说，扒它。")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[n("font",{attrs:{size:"4"}},[t._v("📂装包")])],1),t._v(" "),n("p",[n("font",{attrs:{size:"3"}},[t._v("Site-Packages")])],1)]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 系统包, 控制文件")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 时间包, 控制时间")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" datetime\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" datetime "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" datetime\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 图像处理")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" base64\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" PIL "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Image\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 模拟浏览器")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" selenium "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" webdriver\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" selenium"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webdriver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firefox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Options\n")])])]),n("p",[t._v("  整体采用的是Python + Geckodriver(Firefox Engine) + Selenium的配置。")]),t._v(" "),n("p",[t._v("  Selenium这个包十分出色，作为爬虫最重要的定位、解析和交互功能，Selenium一应俱全。")]),t._v(" "),n("p",[t._v("  它支持多种元素检索方式，基本上HTML描述元素特征的内容都可以拿来用，如id, tag_name(标签名), class_name(网页类名); 复杂的用到css_selector(复杂类选择器), x_path(DOM树路径); 网页元素被抽象成<WebElement>, 这样一来局部检索能力加强了很多，复合一些模糊搜索语法，大多数检索需求都能得心应手。")]),t._v(" "),n("p",[t._v("  解析按照HTML内容结构，直接获取属性值即可。交互方面和BeautifulSoup这类离线解析方式不一样，Selenium是纯浏览器模拟的，可以模拟鼠标键盘事件，更重要的是可以让浏览器在页面上执行JS脚本。")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[n("font",{attrs:{size:"4"}},[t._v("👀加载&监听")])],1),t._v(" "),n("p",[n("font",{attrs:{size:"3"}},[t._v("Loading and Listen-on")])],1)]),t._v(" "),n("p",[t._v("  思路就是爬虫挂在页面上持续刷新，恰好地铁官方页面给出了数据时间，不断检测时间将新的页面内容抓回本地即可。整个过程没什么难点，因为只是公示信息，页面没有任何反爬虫机制。早上出去上班，给小本本充电保持网络稳定挂在那儿跑，晚上回来就有一整天的页面信息了。")]),t._v(" "),n("p",[t._v("  稍微比较麻烦的是这张地铁地图的解析，页面为了实现更好的交互，地图不是简单的静态url指向图片，而是HTML5 Canvas对象。需要额外调用接口"),n("a",{attrs:{href:"https://topic.alibabacloud.com/a/canvas-todataurl--convert-picture-to-dataurl-base64_8_8_20263076.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("toDataURL"),n("OutboundLink")],1),t._v("将图片按照base64编码，到本地后再用第三方包解码。")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 调用js下载图片")]),t._v("\ncanvas "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_element_by_tag_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canvas"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\njs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"return arguments[0].toDataURL('image/png').substring(21);\"")]),t._v("\ncanvas_base64 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute_script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncanvas_png "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" base64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b64decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("canvas_base64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 按时间命名")]),t._v("\nfp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('r"{0}\\{1}.png"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("canvas_png"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[n("font",{attrs:{size:"4"}},[t._v("🔧粗加工")])],1),t._v(" "),n("p",[n("font",{attrs:{size:"3"}},[t._v("Fabrication")])],1)]),t._v(" "),n("p",[t._v("  其实为了后面数据处理方式多样可变，贴源数据应该尽可能保持原始内容，不做过多的处理。")]),t._v(" "),n("p",[t._v("  如果有需要，可以用PIL，cv2等图像处理包加工处理，比如剪裁，加盖时间戳，调节分辨率，甚至是生成GIF或者视频将批量图片串接起来。总之Python有丰富成熟的第三方包实现大多数想做的，这里不再赘述。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(323),alt:"GIFofMap"}})]),t._v(" "),n("h1",{attrs:{id:"代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[t._v("#")]),t._v(" "),n("font",{attrs:{size:"5"}},[t._v("代码")])],1),t._v(" "),n("p",[t._v("贴一下代码，下一节将上手处理图片信息。")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''\nAuthor:     Kim Tse\nDate:       03AUG2020\nContact:    kimtsegzc@gmail.com / 747903456@qq.com\n'''")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ========初始化========")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" driver       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 浏览器geckodriver-v0.26.0-win64")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" uptodate     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 页面数据时间, 日期变量")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" _date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _time "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日期时间, 字符变量")]),t._v("\n    options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# options.headless = True  # 无头浏览开关")]),t._v("\n    driver "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" webdriver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Firefox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set_window_position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set_window_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1550")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("650")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://ydyc.gzmtr.cn:19090/pcindex.html#/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定位时间戳, 参数初始化")]),t._v("\n    bar "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_element_by_css_selector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"[class='nav_list upToDate']\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    uptodate "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strptime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_elements_by_tag_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%Y-%m-%d %H:%M"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    _date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _time "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_elements_by_tag_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("scrshot")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# --------网页截图--------")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" driver       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 浏览器geckodriver-v0.26.0-win64")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" uptodate     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 页面数据时间, 日期变量")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" _date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _time "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日期时间, 字符变量")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n>>Note: Shot at "')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uptodate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以当前日期为路径建文件夹")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makedirs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 调用js下载图片")]),t._v("\n    canvas "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_element_by_tag_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canvas"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    js "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"return arguments[0].toDataURL('image/png').substring(21);\"")]),t._v("\n    canvas_base64 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute_script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    canvas_png "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" base64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b64decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("canvas_base64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 按时间命名")]),t._v("\n    fp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('r"{0}\\{1}.png"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("canvas_png"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加工图片: 剪裁")]),t._v("\n    im "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" height "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" im"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size\n    im "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" im"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("crop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("round")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("width "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("round")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" width "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    im"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listenon")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ========页面监听========")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" driver       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 浏览器geckodriver-v0.26.0-win64")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" uptodate     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 页面数据时间, 日期变量")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" _date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _time "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日期时间, 字符变量")]),t._v("\n    _last "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" uptodate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hour "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" _last "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" _time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                scrshot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                _last "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _time\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"!!Warn: Failed at "')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uptodate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refresh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更新时间戳")]),t._v("\n        bar "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_element_by_css_selector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"[class='nav_list upToDate']\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        uptodate "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strptime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_elements_by_tag_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%Y-%m-%d %H:%M"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        _date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _time "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_elements_by_tag_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ninit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlistenon"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndriver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);