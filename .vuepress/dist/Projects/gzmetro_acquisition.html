<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kim Tse&#39;s blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.290125c9.css" as="style"><link rel="preload" href="/assets/js/app.41896d2f.js" as="script"><link rel="preload" href="/assets/js/2.d2315cb7.js" as="script"><link rel="preload" href="/assets/js/4.ed3cff30.js" as="script"><link rel="prefetch" href="/assets/js/10.f94ced8a.js"><link rel="prefetch" href="/assets/js/11.6186bb92.js"><link rel="prefetch" href="/assets/js/12.f6d94480.js"><link rel="prefetch" href="/assets/js/3.2a2dbe57.js"><link rel="prefetch" href="/assets/js/5.33b51ea0.js"><link rel="prefetch" href="/assets/js/6.f07252da.js"><link rel="prefetch" href="/assets/js/7.97744c46.js"><link rel="prefetch" href="/assets/js/8.dddc8c80.js"><link rel="prefetch" href="/assets/js/9.19c56608.js">
    <link rel="stylesheet" href="/assets/css/0.styles.290125c9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kim Tse's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Homepage
</a></div><div class="nav-item"><a href="/Karena.html" class="nav-link">
  Karena
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Homepage
</a></div><div class="nav-item"><a href="/Karena.html" class="nav-link">
  Karena
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/preface.html" class="sidebar-link">Preface</a></li><li><a href="/Projects/gzmetro_acquisition.html" class="active sidebar-link">å¹¿å·åœ°é“æœ‰å¤šæŒ¤(æ•°æ®è·å–)</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="å¹¿å·åœ°é“æœ‰å¤šæŒ¤-æ•°æ®è·å–"><a href="#å¹¿å·åœ°é“æœ‰å¤šæŒ¤-æ•°æ®è·å–" class="header-anchor">#</a> <font size="6">å¹¿å·åœ°é“æœ‰å¤šæŒ¤-æ•°æ®è·å–</font></h1> <blockquote><p><font size="5," color="grey">å•é¡µçˆ¬è™«å®æ—¶ç›‘å¬</font></p></blockquote> <h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="header-anchor">#</a> <font size="5">ç®€ä»‹</font></h1> <p>â€ƒâ€ƒå› ä¸ºæ¯å¤©éƒ½è¦æŒ¤åœ°é“ä¸Šç­ï¼Œå‘¨é­åŠ³é¡¿ã€‚ç­‰è½¦çš„æ—¶å€™ï¼Œæˆ‘çªç„¶æƒ³åˆ°äº†è¿™ä¹ˆä¸ªé—®é¢˜ï¼šå¹¿å·åœ°é“åˆ°åº•æœ‰å¤šæŒ¤ï¼Ÿ</p> <p>â€ƒâ€ƒäºæ˜¯æƒ³é‡‡é›†ä¸€äº›æ•°æ®åšç‚¹åˆ†æï¼Œéœ€è¦é‡‡é›†å“ªäº›æ•°æ®ï¼Ÿæ•°æ®åœ¨å“ªé‡Œå‘¢ï¼ŸğŸ’¡</p> <p>â€ƒâ€ƒé¦–å…ˆæ˜¯å¸¸é‡æ•°æ®ï¼Œæ¯ä¸ªç«™ç‚¹çš„å®¢å®¹é‡ï¼Œä¸€è¶Ÿåˆ—è½¦çš„æ€»æ‰¿è½½ï¼Œè½¦æ¬¡å®‰æ’æ—¶é—´è¡¨ç­‰ç­‰ï¼›ç„¶åæ˜¯æµåŠ¨æ•°æ®ï¼Œåªè¦è®°å½•ä¸ªäººè¿›ç«™å‡ºç«™çš„æ—¶é—´åœ°ç‚¹å³å¯ï¼›å¦å¤–å®šä¹‰å¥½ä¸€ç³»åˆ—æ•°æ®ç‰¹å¾æ¥åˆ»ç”»ç³»ç»ŸçŠ¶æ€ï¼Œæ¯”å¦‚å•ä½æ—¶é—´æµå…¥-æµå‡ºä¸ºç§¯ç´¯é€Ÿç‡ï¼Œå­˜é‡ä¹˜å®¢/å®¢å®¹é‡ &gt; 90%ä¸ºæ‹¥å µç­‰ç­‰ã€‚</p> <p>â€ƒâ€ƒåœ¨è¿™å¥—æ•°æ®åŸºç¡€ä¸Šå¯ä»¥å¼•å…¥ç®—æ³•æ·±å…¥åˆ†æç³»ç»Ÿè¿è¡Œæ•ˆç‡ï¼š</p> <ul><li><strong>åˆ†ç±»é—®é¢˜ï¼š</strong> æŠŠé«˜å³°æ—¶æ®µä¹˜å®¢åˆ†ç±»å‡ºæ¥ï¼Œè®­ç»ƒé›†åŒ…æ‹¬å†å²ä¹˜è½¦ä¿¡æ¯å’Œä¹˜å®¢ç±»å‹ã€‚åƒæˆ‘è¿™ç§å‘¨ä¸€åˆ°å‘¨äº”ï¼Œå®šæ—¶å®šç‚¹ç¨³å®šå‡ºç°çš„è‚¯å®šå°±æ˜¯æ‰“å·¥ä»”äº†ï¼›ä¹‹å‰éƒ½æ²¡æ¥è¿‡çš„çªç„¶èµ¶è¿™ç­è½¦ï¼Œåº”è¯¥å°±æ˜¯ä¸´æ—¶å‡ºå·®çš„ï¼›å†æœ‰å®šç‚¹ä¸å®šæ—¶çš„ï¼Œå¯èƒ½æ˜¯æˆ¿ä¸œå‡ºé—¨ä¹°èœ...</li> <li><strong>é¢„æµ‹é—®é¢˜ï¼š</strong> åœ¨åˆ†ç±»çš„åŸºç¡€ä¸Šå‡å®šæ¯å¤©é«˜å³°æ—¶æ®µå„ç±»ä¹˜å®¢æ•°é‡å¤§ä½“ç¨³å®šï¼Œå®¢æµé‡æœä»åŠ¨æ€çš„(å¯†åº¦=å‰©ä½™é«˜å³°ä¹˜å®¢/å‰©ä½™é«˜å³°æ—¶é—´)æ³Šæ¾åˆ†å¸ƒï¼Œç«™ç‚¹å¤šä¹…å°†è¿›å…¥æ‹¥å µæ€ï¼Ÿæ‹¥å µæ—¶é•¿å¤šé•¿ï¼Ÿ</li> <li><strong>ä¼˜åŒ–é—®é¢˜ï¼š</strong> æ ¹æ®éœ€æ±‚ä¾§ç»“æ„å¯¹èµ„æºé…ç½®åšå‚æ•°ä¼˜åŒ–ï¼Œæ˜¯å¦å¯ä»¥è°ƒæ•´è½¦æ¬¡æ—¶é—´è¡¨ä½¿å¾—æ‹¥å µæ—¶é•¿å‡å°ï¼Ÿ</li></ul> <h1 id="é‡‡é›†"><a href="#é‡‡é›†" class="header-anchor">#</a> <font size="5">é‡‡é›†</font></h1> <p>â€ƒâ€ƒä»¥ä¸Šå†…å®¹éƒ½æ˜¯æˆ‘è¢«äººæŠµåœ¨è½¦é—¨å£å•æ‰‹æ‰£ç€æŒ‡ç¤ºæ¿ğŸ˜«æƒ³å‡ºæ¥çš„ï¼Œæœ‰å¾—æå—ï¼Ÿå±å¨...ä¸ªäººäº¤é€šä¿¡æ¯æ€ä¹ˆå¯èƒ½æå¾—åˆ°ï¼Œæœ€åæˆ‘æƒ³å¹¿å·åœ°é“å®˜æ–¹ä¼šä¸ä¼šæœ‰æ•°æ®æŠ«éœ²ï¼Œäºæ˜¯æˆ‘æ‰¾åˆ°äº†<a href="http://ydyc.gzmtr.cn:19090/pcindex.html#/" target="_blank" rel="noopener noreferrer">å¹¿å·åœ°é“å®¢æµå®æ—¶ä¿¡æ¯æ˜¾ç¤ºç³»ç»Ÿ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</p> <p><img src="/assets/img/gzmetromap.d851a6b6.png" alt="gzmetromap"></p> <p>â€ƒâ€ƒé¡µé¢æ˜¯å¼ å®æ—¶åœ°é“ä¿¡æ¯å›¾ï¼ŒåŒ…æ‹¬ç«™ç‚¹å’ŒåŒå‘é€šè¡Œæƒ…å†µã€‚è™½ç„¶å®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„ç»Ÿè®¡å£å¾„ï¼Œè¿™æ ·ä¹Ÿå…å»é‡æ–°å®šä¹‰ç³»ç»ŸçŠ¶æ€çš„å¿…è¦äº†ã€‚ä¸å¤šè¯´ï¼Œæ‰’å®ƒã€‚</p> <div class="custom-block tip"><p class="custom-block-title"><font size="4">ğŸ“‚è£…åŒ…</font></p> <p><font size="3">Site-Packages</font></p></div> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># ç³»ç»ŸåŒ…, æ§åˆ¶æ–‡ä»¶</span>
<span class="token keyword">import</span> os
<span class="token comment"># æ—¶é—´åŒ…, æ§åˆ¶æ—¶é—´</span>
<span class="token keyword">import</span> time
<span class="token keyword">import</span> datetime
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token comment"># å›¾åƒå¤„ç†</span>
<span class="token keyword">import</span> base64
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token comment"># æ¨¡æ‹Ÿæµè§ˆå™¨</span>
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>firefox<span class="token punctuation">.</span>options <span class="token keyword">import</span> Options
</code></pre></div><p>â€ƒâ€ƒæ•´ä½“é‡‡ç”¨çš„æ˜¯Python + Geckodriver(Firefox Engine) + Seleniumçš„é…ç½®ã€‚</p> <p>â€ƒâ€ƒSeleniumè¿™ä¸ªåŒ…ååˆ†å‡ºè‰²ï¼Œä½œä¸ºçˆ¬è™«æœ€é‡è¦çš„å®šä½ã€è§£æå’Œäº¤äº’åŠŸèƒ½ï¼ŒSeleniumä¸€åº”ä¿±å…¨ã€‚</p> <p>â€ƒâ€ƒå®ƒæ”¯æŒå¤šç§å…ƒç´ æ£€ç´¢æ–¹å¼ï¼ŒåŸºæœ¬ä¸ŠHTMLæè¿°å…ƒç´ ç‰¹å¾çš„å†…å®¹éƒ½å¯ä»¥æ‹¿æ¥ç”¨ï¼Œå¦‚id, tag_name(æ ‡ç­¾å), class_name(ç½‘é¡µç±»å); å¤æ‚çš„ç”¨åˆ°css_selector(å¤æ‚ç±»é€‰æ‹©å™¨), x_path(DOMæ ‘è·¯å¾„); ç½‘é¡µå…ƒç´ è¢«æŠ½è±¡æˆ&lt;WebElement&gt;, è¿™æ ·ä¸€æ¥å±€éƒ¨æ£€ç´¢èƒ½åŠ›åŠ å¼ºäº†å¾ˆå¤šï¼Œå¤åˆä¸€äº›æ¨¡ç³Šæœç´¢è¯­æ³•ï¼Œå¤§å¤šæ•°æ£€ç´¢éœ€æ±‚éƒ½èƒ½å¾—å¿ƒåº”æ‰‹ã€‚</p> <p>â€ƒâ€ƒè§£ææŒ‰ç…§HTMLå†…å®¹ç»“æ„ï¼Œç›´æ¥è·å–å±æ€§å€¼å³å¯ã€‚äº¤äº’æ–¹é¢å’ŒBeautifulSoupè¿™ç±»ç¦»çº¿è§£ææ–¹å¼ä¸ä¸€æ ·ï¼ŒSeleniumæ˜¯çº¯æµè§ˆå™¨æ¨¡æ‹Ÿçš„ï¼Œå¯ä»¥æ¨¡æ‹Ÿé¼ æ ‡é”®ç›˜äº‹ä»¶ï¼Œæ›´é‡è¦çš„æ˜¯å¯ä»¥è®©æµè§ˆå™¨åœ¨é¡µé¢ä¸Šæ‰§è¡ŒJSè„šæœ¬ã€‚</p> <div class="custom-block tip"><p class="custom-block-title"><font size="4">ğŸ‘€åŠ è½½&amp;ç›‘å¬</font></p> <p><font size="3">Loading and Listen-on</font></p></div> <p>â€ƒâ€ƒæ€è·¯å°±æ˜¯çˆ¬è™«æŒ‚åœ¨é¡µé¢ä¸ŠæŒç»­åˆ·æ–°ï¼Œæ°å¥½åœ°é“å®˜æ–¹é¡µé¢ç»™å‡ºäº†æ•°æ®æ—¶é—´ï¼Œä¸æ–­æ£€æµ‹æ—¶é—´å°†æ–°çš„é¡µé¢å†…å®¹æŠ“å›æœ¬åœ°å³å¯ã€‚æ•´ä¸ªè¿‡ç¨‹æ²¡ä»€ä¹ˆéš¾ç‚¹ï¼Œå› ä¸ºåªæ˜¯å…¬ç¤ºä¿¡æ¯ï¼Œé¡µé¢æ²¡æœ‰ä»»ä½•åçˆ¬è™«æœºåˆ¶ã€‚æ—©ä¸Šå‡ºå»ä¸Šç­ï¼Œç»™å°æœ¬æœ¬å……ç”µä¿æŒç½‘ç»œç¨³å®šæŒ‚åœ¨é‚£å„¿è·‘ï¼Œæ™šä¸Šå›æ¥å°±æœ‰ä¸€æ•´å¤©çš„é¡µé¢ä¿¡æ¯äº†ã€‚</p> <p>â€ƒâ€ƒç¨å¾®æ¯”è¾ƒéº»çƒ¦çš„æ˜¯è¿™å¼ åœ°é“åœ°å›¾çš„è§£æï¼Œé¡µé¢ä¸ºäº†å®ç°æ›´å¥½çš„äº¤äº’ï¼Œåœ°å›¾ä¸æ˜¯ç®€å•çš„é™æ€urlæŒ‡å‘å›¾ç‰‡ï¼Œè€Œæ˜¯HTML5 Canvaså¯¹è±¡ã€‚éœ€è¦é¢å¤–è°ƒç”¨æ¥å£<a href="https://topic.alibabacloud.com/a/canvas-todataurl--convert-picture-to-dataurl-base64_8_8_20263076.html" target="_blank" rel="noopener noreferrer">toDataURL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>å°†å›¾ç‰‡æŒ‰ç…§base64ç¼–ç ï¼Œåˆ°æœ¬åœ°åå†ç”¨ç¬¬ä¸‰æ–¹åŒ…è§£ç ã€‚</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># è°ƒç”¨jsä¸‹è½½å›¾ç‰‡</span>
canvas <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_tag_name<span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span>
js <span class="token operator">=</span> <span class="token string">&quot;return arguments[0].toDataURL('image/png').substring(21);&quot;</span>
canvas_base64 <span class="token operator">=</span> driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span>js<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
canvas_png <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>canvas_base64<span class="token punctuation">)</span>
<span class="token comment"># æŒ‰æ—¶é—´å‘½å</span>
fp <span class="token operator">=</span> <span class="token string">r&quot;{0}\{1}.png&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>_date<span class="token punctuation">,</span> _time<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>canvas_png<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title"><font size="4">ğŸ”§ç²—åŠ å·¥</font></p> <p><font size="3">Fabrication</font></p></div> <p>â€ƒâ€ƒå…¶å®ä¸ºäº†åé¢æ•°æ®å¤„ç†æ–¹å¼å¤šæ ·å¯å˜ï¼Œè´´æºæ•°æ®åº”è¯¥å°½å¯èƒ½ä¿æŒåŸå§‹å†…å®¹ï¼Œä¸åšè¿‡å¤šçš„å¤„ç†ã€‚</p> <p>â€ƒâ€ƒå¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥ç”¨PILï¼Œcv2ç­‰å›¾åƒå¤„ç†åŒ…åŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚å‰ªè£ï¼ŒåŠ ç›–æ—¶é—´æˆ³ï¼Œè°ƒèŠ‚åˆ†è¾¨ç‡ï¼Œç”šè‡³æ˜¯ç”ŸæˆGIFæˆ–è€…è§†é¢‘å°†æ‰¹é‡å›¾ç‰‡ä¸²æ¥èµ·æ¥ã€‚æ€»ä¹‹Pythonæœ‰ä¸°å¯Œæˆç†Ÿçš„ç¬¬ä¸‰æ–¹åŒ…å®ç°å¤§å¤šæ•°æƒ³åšçš„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p> <p><img src="/assets/img/GIFofMap.45d2091d.gif" alt="GIFofMap"></p> <h1 id="ä»£ç "><a href="#ä»£ç " class="header-anchor">#</a> <font size="5">ä»£ç </font></h1> <p>è´´ä¸€ä¸‹ä»£ç ï¼Œä¸‹ä¸€èŠ‚å°†ä¸Šæ‰‹å¤„ç†å›¾ç‰‡ä¿¡æ¯ã€‚</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">'''
Author:     Kim Tse
Date:       03AUG2020
Contact:    kimtsegzc@gmail.com / 747903456@qq.com
'''</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ========åˆå§‹åŒ–========</span>
    <span class="token keyword">global</span> driver       <span class="token comment"># æµè§ˆå™¨geckodriver-v0.26.0-win64</span>
    <span class="token keyword">global</span> uptodate     <span class="token comment"># é¡µé¢æ•°æ®æ—¶é—´, æ—¥æœŸå˜é‡</span>
    <span class="token keyword">global</span> _date<span class="token punctuation">,</span> _time <span class="token comment"># æ—¥æœŸæ—¶é—´, å­—ç¬¦å˜é‡</span>
    options <span class="token operator">=</span> Options<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># options.headless = True  # æ— å¤´æµè§ˆå¼€å…³</span>
    driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>set_window_position<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>set_window_size<span class="token punctuation">(</span><span class="token number">1550</span><span class="token punctuation">,</span><span class="token number">650</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://ydyc.gzmtr.cn:19090/pcindex.html#/&quot;</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token comment"># å®šä½æ—¶é—´æˆ³, å‚æ•°åˆå§‹åŒ–</span>
    bar <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">&quot;[class='nav_list upToDate']&quot;</span><span class="token punctuation">)</span>
    uptodate <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>bar<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">&quot;%Y-%m-%d %H:%M&quot;</span><span class="token punctuation">)</span>
    _date<span class="token punctuation">,</span> _time <span class="token operator">=</span> <span class="token punctuation">(</span>bar<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">scrshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># --------ç½‘é¡µæˆªå›¾--------</span>
    <span class="token keyword">global</span> driver       <span class="token comment"># æµè§ˆå™¨geckodriver-v0.26.0-win64</span>
    <span class="token keyword">global</span> uptodate     <span class="token comment"># é¡µé¢æ•°æ®æ—¶é—´, æ—¥æœŸå˜é‡</span>
    <span class="token keyword">global</span> _date<span class="token punctuation">,</span> _time <span class="token comment"># æ—¥æœŸæ—¶é—´, å­—ç¬¦å˜é‡</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt;&gt;Note: Shot at &quot;</span><span class="token punctuation">,</span> uptodate<span class="token punctuation">)</span>
    <span class="token comment"># ä»¥å½“å‰æ—¥æœŸä¸ºè·¯å¾„å»ºæ–‡ä»¶å¤¹</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>_date<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>_date<span class="token punctuation">)</span>
    <span class="token comment"># è°ƒç”¨jsä¸‹è½½å›¾ç‰‡</span>
    canvas <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_tag_name<span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span>
    js <span class="token operator">=</span> <span class="token string">&quot;return arguments[0].toDataURL('image/png').substring(21);&quot;</span>
    canvas_base64 <span class="token operator">=</span> driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span>js<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
    canvas_png <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>canvas_base64<span class="token punctuation">)</span>
    <span class="token comment"># æŒ‰æ—¶é—´å‘½å</span>
    fp <span class="token operator">=</span> <span class="token string">r&quot;{0}\{1}.png&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>_date<span class="token punctuation">,</span> _time<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>canvas_png<span class="token punctuation">)</span>
    <span class="token comment"># åŠ å·¥å›¾ç‰‡: å‰ªè£</span>
    im <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span>
    width<span class="token punctuation">,</span> height <span class="token operator">=</span> im<span class="token punctuation">.</span>size
    im <span class="token operator">=</span> im<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>width <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> width <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">500</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span>
    im<span class="token punctuation">.</span>save<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">listenon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ========é¡µé¢ç›‘å¬========</span>
    <span class="token keyword">global</span> driver       <span class="token comment"># æµè§ˆå™¨geckodriver-v0.26.0-win64</span>
    <span class="token keyword">global</span> uptodate     <span class="token comment"># é¡µé¢æ•°æ®æ—¶é—´, æ—¥æœŸå˜é‡</span>
    <span class="token keyword">global</span> _date<span class="token punctuation">,</span> _time <span class="token comment"># æ—¥æœŸæ—¶é—´, å­—ç¬¦å˜é‡</span>
    _last <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">&lt;=</span> uptodate<span class="token punctuation">.</span>hour <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> _last <span class="token operator">!=</span> _time<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                scrshot<span class="token punctuation">(</span><span class="token punctuation">)</span>
                _last <span class="token operator">=</span> _time
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;!!Warn: Failed at &quot;</span><span class="token punctuation">,</span> uptodate<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token comment"># æ›´æ–°æ—¶é—´æˆ³</span>
        bar <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">&quot;[class='nav_list upToDate']&quot;</span><span class="token punctuation">)</span>
        uptodate <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>bar<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">&quot;%Y-%m-%d %H:%M&quot;</span><span class="token punctuation">)</span>
        _date<span class="token punctuation">,</span> _time <span class="token operator">=</span> <span class="token punctuation">(</span>bar<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>

init<span class="token punctuation">(</span><span class="token punctuation">)</span>
listenon<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/preface.html" class="prev">
        Preface
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.41896d2f.js" defer></script><script src="/assets/js/2.d2315cb7.js" defer></script><script src="/assets/js/4.ed3cff30.js" defer></script>
  </body>
</html>
